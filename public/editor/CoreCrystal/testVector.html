<!DOCTYPE html>
<html lang="en">
<head>
    <title>Kisti Cad</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
</head>
<body style="overflow:hidden;margin:0px;">
    <div id="vrmoleapp" style="float:left;overflow:hidden;width:100%;height:100%;"></div>

    <script src="../CadEditor/zui/external/jquery/jquery.js"></script>
    <script src="../Core/jsbuild/kVisLib.js"></script>
    <script src="../Core/jsbuild/kVisLibBind.js"></script>
    <script type="module">

        import * as THREE from '../build/three.module.js';
        import { Renderer } from '../Renderer/Renderer.js';
        import { GeomRenderer } from '../Renderer/GeomRenderer.js';
        import { Colormap } from '../Renderer/Colormap.js';
        import { Vector3 } from '../Math/Vector3.js';
        import { GeomMole } from '../Renderer/GeomMole.js';

        import { CStructure } from './CStructure.js';
        import { CAtom } from './CAtom.js';
        import { CBond } from './CBond.js';
        import { tVector } from './tVector.js';

        var renderer;
        var mouse = new THREE.Vector2(), SELECTED;
        var scoord = new THREE.Vector2();

        var cdiv = document.getElementById('vrmoleapp');


        var cm = new Colormap();
        cm.addColor(0, 1, 0, 0);
        cm.addColor(0.5, 0, 1, 0);
        cm.addColor(1, 0, 0, 0);

        var c1 = cm.get(0.1);
        var c2 = cm.get(0.3);
        var c3 = cm.get(1);
        var c4 = cm.get(0.9);




        function onDocumentMouseMove(event) {

            event.preventDefault();

            mouse.x = event.clientX;
            mouse.y = event.clientY;

            //console.log("mouse move :"+mouse.x+" "+mouse.y);

            scoord.x = mouse.x / cdiv.clientWidth;
            scoord.y = mouse.y / cdiv.clientHeight;

            //console.log("mouse move scoord :" + scoord.x + " " + scoord.y);

        }



        function onDocumentMouseDown(event) {

            event.preventDefault();

            mouse.x = event.clientX;
            mouse.y = event.clientY;

            //console.log("mouse down :" + mouse.x + " " + mouse.y);

            scoord.x = mouse.x / cdiv.clientWidth;
            scoord.y = mouse.y / cdiv.clientHeight;

            //console.log("mouse down scoord :" + scoord.x + " " + scoord.y);

        }



        kVisLib.Init(function () {

            renderer = new Renderer(cdiv, false, true);
            renderer.create3DOrthographicCamera(-100, 100, 100, -100, 0, 1000);
            renderer.createPerspecriveCamera(100, 100, 100, 50, 1.5, 0.1, 1000);
            renderer.createOrbitControl();
            // renderer.createTrackballControl();
            renderer.createCameraLight();

            GeomMole.init();

            //cdiv.addEventListener('pointerdown', onDocumentMouseDown);
            //cdiv.addEventListener('pointermove', onDocumentMouseMove);

            window.addEventListener('resize', function () {
                cdiv.style.width = window.innerWidth + "px";
                cdiv.style.height = window.innerHeight + "px";
                renderer.onWindowResize(window.innerWidth, window.innerHeight);
            });

            renderer.onWindowResize(window.innerWidth, window.innerHeight);

            var gg = new GeomRenderer(kVisLib.api, renderer);

            // 데이터를 저장할 crystal structure 생성
            let cs = new CStructure();

            // Unit cell 정의
            cs._unitcell.set(90, 90, 90, 5, 5, 5);

            // 아톰 하나 정의, CS에 추가
            let a1 = new CAtom();
            a1._position.set(.1, .1, .1);
            a1._label = "aa";
            a1.setAtomID(1);
            cs.addAtom(a1);

            // 아톰 하나 정의, CS에 추가
            let a2 = new CAtom();
            a2._position.set(.6, .4, .8);
            a2._label = "b";
            a2.setAtomID(8);
            cs.addAtom(a2);

            // 아톰 하나 정의, CS에 추가
            let a3 = new CAtom();
            a3._position.set(0, 0, 0);
            a3._label = "a3";
            a3.setAtomID(2);
            cs.addAtom(a3);

            // 본드 하나 정의, CS에 추가
            let b1 = new CBond();
            b1.setLength(0, 8);
            b1.setAtom(a1, a2);
            cs.addBond(b1);


            let v1 = new tVector([0, 0.2, 0], [0, 1, 1], 0.1);
            cs.addVector2CAtom(a3, v1);

            let v2 = new tVector([0.2, 0, 0], [0, 0, 1], 0.1);
            cs.addVector2iAtomWithPos([0, 0, 0], 1, v2);


            // 바운더리 정의
            cs._boundary.set(new Vector3(0, 0, 0), new Vector3(1, 1, 1));

            // three.mesh 생성
            cs.generate();

            // 생성된 메쉬를 three에 추가
            //let mesh1 = gg.addNewGeom2(cs._atomGeomGroup);
            //let mesh3 = gg.addNewGeom2(cs._bondGeomGroup);

            renderer._scene.add(cs._groupMesh);


            render();
        });


        function render() {
            requestAnimationFrame(render);

            renderer.tick();
            renderer.render();
        }




    </script>
</body>
</html>
